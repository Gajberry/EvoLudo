<!-- ant build file for VirtualLabs -->

<project name="VirtualLabs" default="web" basedir="." >

	<!-- Properties -->

	<property name="src" value="src"/>
	<property name="build" value="build"/>
	<property name="build.classes" value="${build}/classes"/>
	<property name="build.applets" value="${build}/applets"/>
	<property name="build.simulations" value="${build}/simulations"/>
	<property name="web" value="web"/>
	<property name="product" value="product"/>

	<property environment="env"/>

	<!-- Targets -->

	<!-- Prepare build directories -->
	<target name="init">
		<mkdir dir="${build}"/>
		<mkdir dir="${build.classes}"/>
		<mkdir dir="${build.applets}"/>
		<mkdir dir="${build.simulations}"/>
		<mkdir dir="${product}"/>
		<condition property="compilerargs" value="-Xlint:all,-serial">
			<equals arg1="${env.DEBUG}" arg2="debug"/>
		</condition>
		<condition property="debug" value="on">
			<equals arg1="${env.DEBUG}" arg2="debug"/>
		</condition>
		<condition property="optimize" value="off">
			<equals arg1="${env.DEBUG}" arg2="debug"/>
		</condition>
		<condition property="nostrip">
			<equals arg1="${env.DEBUG}" arg2="debug"/>
		</condition>
		<condition property="listfiles" value="on">
			<equals arg1="${env.DEBUG}" arg2="debug"/>
		</condition>
	</target>

	<!-- Kill all the created directories -->
	<target name="clean">
		<delete dir="${build}"/>
		<delete dir="${product}"/>
	</target>

	<!-- Moran -->
	<target name="Moran">
		<antcall target="-dapplet">
			<param name="applet" value="Moran"/>
		</antcall>
	</target>

	<target name="cleanMoran">
		<antcall target="-clean">
			<param name="applet" value="Moran"/>
		</antcall>
	</target>

	<!-- 2x2 -->
	<target name="2x2">
		<antcall target="-dapplet">
			<param name="applet" value="2x2"/>
			<param name="main" value="TwoByTwo"/>
		</antcall>
	</target>

	<target name="clean2x2">
		<antcall target="-clean">
			<param name="applet" value="2x2"/>
		</antcall>
	</target>

	<!-- public goods -->
	<target name="PGG">
		<antcall target="-dapplet">
			<param name="applet" value="PublicGoods"/>
		</antcall>
	</target>

	<target name="cleanPGG">
		<antcall target="-clean">
			<param name="applet" value="PublicGoods"/>
		</antcall>
	</target>

	<!-- voluntary public goods -->
	<target name="CDL">
		<antcall target="-dapplet">
			<param name="applet" value="CDL"/>
		</antcall>
	</target>

	<target name="cleanCDL">
		<antcall target="-clean">
			<param name="applet" value="CDL"/>
		</antcall>
	</target>

	<!-- voluntary public goods with punishment -->
	<target name="CDLP">
		<antcall target="-dapplet">
			<param name="applet" value="CDLP"/>
		</antcall>
	</target>

	<target name="simCDLP">
		<antcall target="-dsims">
			<param name="core" value="CDLP"/>
			<param name="sim" value="simCDLP"/>
		</antcall>
	</target>

	<target name="cleanCDLP">
		<antcall target="-clean">
			<param name="applet" value="CDLP"/>
		</antcall>
	</target>

	<!-- voluntary public goods with peer punishment & sanctioning -->
	<target name="CDLPQ">
		<antcall target="-dapplet">
			<param name="applet" value="CDLPQ"/>
		</antcall>
	</target>

	<target name="simCDLPQ">
		<antcall target="-dsims">
			<param name="core" value="CDLPQ"/>
			<param name="sim" value="simCDLPQ"/>
		</antcall>
	</target>

	<target name="cleanCDLPQ">
		<antcall target="-clean">
			<param name="applet" value="CDLPQ"/>
		</antcall>
	</target>

	<!-- synergy & discounting -->
	<target name="Discount">
		<antcall target="-dapplet">
			<param name="applet" value="Discount"/>
		</antcall>
	</target>

	<target name="cleanDiscount">
		<antcall target="-clean">
			<param name="applet" value="Discount"/>
		</antcall>
	</target>

	<!-- ecological public goods -->
	<target name="EcoPGG">
		<antcall target="-dapplet">
			<param name="applet" value="EcoPGG"/>
			<param name="main" value="EcoPublicGoods"/>
		</antcall>
	</target>

	<target name="cleanEcoPGG">
		<antcall target="-clean">
			<param name="applet" value="EcoPGG"/>
		</antcall>
	</target>

	<!-- punishment & reputation -->
	<target name="Punishment">
		<antcall target="-dapplet">
			<param name="applet" value="Punishment"/>
		</antcall>
	</target>

	<target name="cleanPunishment">
		<antcall target="-clean">
			<param name="applet" value="Punishment"/>
		</antcall>
	</target>

	<!-- reward & reputation -->
	<target name="Reward">
		<antcall target="-dapplet">
			<param name="applet" value="Reward"/>
		</antcall>
	</target>

	<target name="simReward">
		<antcall target="-dsims">
			<param name="core" value="Reward"/>
			<param name="sim" value="simReward"/>
		</antcall>
	</target>

	<target name="cleanReward">
		<antcall target="-clean">
			<param name="applet" value="Reward"/>
		</antcall>
	</target>

	<!-- rock, paper, scissors -->
	<target name="RSP">
		<antcall target="-dapplet">
			<param name="applet" value="RSP"/>
		</antcall>
	</target>

	<target name="cleanRSP">
		<antcall target="-clean">
			<param name="applet" value="RSP"/>
		</antcall>
	</target>

	<!-- continuous 2x2 -->
	<target name="C2x2">
		<antcall target="-capplet">
			<param name="applet" value="C2x2"/>
			<param name="main" value="CTwoByTwo"/>
		</antcall>
	</target>

	<target name="cleanC2x2">
		<antcall target="-clean">
			<param name="applet" value="C2x2"/>
		</antcall>
	</target>

	<!-- continuous snowdrift -->
	<target name="CSD">
		<antcall target="-capplet">
			<param name="applet" value="CSD"/>
		</antcall>
	</target>

	<target name="cleanCSD">
		<antcall target="-clean">
			<param name="applet" value="CSD"/>
		</antcall>
	</target>

	<!-- continuous labour -->
	<target name="CLabour">
		<antcall target="-capplet">
			<param name="applet" value="CLabour"/>
		</antcall>
	</target>

	<target name="cleanCLabour">
		<antcall target="-clean">
			<param name="applet" value="CLabour"/>
		</antcall>
	</target>

	<!-- build web tutorials -->
	<target name="web">
		<antcall target="-web">
			<param name="nosvg" value="true"/>
			<param name="noparser" value="true"/>
			<param name="strip" value="true"/>
		</antcall>
	</target>

	<target name="-web" depends="web-Intro,web-Moran,web-2x2,web-Snowdrift,web-PGG,web-CDL,web-CDLP,web-Discount,web-EcoPGG,web-RePun,web-CSD,web-general">
		<copy todir="${product}/images">
			<fileset dir="${web}/images"/>
		</copy>
		<copy todir="${product}" file="${web}/favicon.ico"/>
		<copy todir="${product}" file="${web}/index.html"/>
	</target>

	<target name="web-general" depends="web-style">
		<copy todir="${product}/General">
			<fileset dir="${web}/General"/>
		</copy>
	</target>

	<target name="web-style">
		<copy todir="${product}/styles">
			<fileset dir="${web}/styles"/>
		</copy>
	</target>

	<target name="cleanweb" depends="clean">
		<delete dir="${product}/styles"/>
		<delete dir="${product}/General"/>
		<delete file="${product}/favicon.ico"/>
		<delete file="${product}/index.html"/>
	</target>

	<target name="web-Intro" depends="RSP,2x2,web-style">
		<copy todir="${product}/Introduction">
			<fileset dir="${web}/Introduction"/>
			<fileset file="${build.applets}/RSP.jar"/>
			<fileset file="${build.applets}/2x2.jar"/>
		</copy>
	</target>

	<target name="web-Moran" depends="Moran,2x2,web-style">
		<copy todir="${product}/Moran">
			<fileset dir="${web}/Moran"/>
			<fileset file="${build.applets}/Moran.jar"/>
			<fileset file="${build.applets}/2x2.jar"/>
		</copy>
	</target>

	<target name="web-2x2" depends="2x2,web-style">
		<copy todir="${product}/TwoByTwo">
			<fileset dir="${web}/TwoByTwo"/>
			<fileset file="${build.applets}/2x2.jar"/>
		</copy>
	</target>

	<target name="web-Snowdrift" depends="2x2,C2x2,web-style">
		<copy todir="${product}/Snowdrift">
			<fileset dir="${web}/Snowdrift"/>
			<fileset file="${build.applets}/2x2.jar"/>
			<fileset file="${build.applets}/C2x2.jar"/>
		</copy>
	</target>

	<target name="web-PGG" depends="PGG,web-style">
		<copy todir="${product}/PublicGoods">
			<fileset dir="${web}/PublicGoods"/>
			<fileset file="${build.applets}/PublicGoods.jar"/>
		</copy>
	</target>

	<target name="web-CDL" depends="CDL,web-style">
		<copy todir="${product}/Volunteering">
			<fileset dir="${web}/Volunteering"/>
			<fileset file="${build.applets}/CDL.jar"/>
		</copy>
	</target>

	<target name="web-CDLP" depends="CDLP,web-style">
		<copy todir="${product}/VolPun">
			<fileset dir="${web}/VolPun"/>
			<fileset file="${build.applets}/CDLP.jar"/>
		</copy>
	</target>

	<target name="web-Discount" depends="Discount,web-style">
		<copy todir="${product}/Discount">
			<fileset dir="${web}/Discount"/>
			<fileset file="${build.applets}/Discount.jar"/>
		</copy>
	</target>

	<target name="web-EcoPGG" depends="EcoPGG,web-style">
		<copy todir="${product}/Ecology">
			<fileset dir="${web}/Ecology"/>
			<fileset file="${build.applets}/EcoPGG.jar"/>
		</copy>
	</target>

	<target name="web-RePun" depends="Reward,Punishment,web-style">
		<copy todir="${product}/RewardAndPunishment">
			<fileset dir="${web}/RewardAndPunishment"/>
			<fileset file="${build.applets}/Reward.jar"/>
			<fileset file="${build.applets}/Punishment.jar"/>
		</copy>
	</target>

	<target name="web-CSD" depends="CSD,web-style">
		<copy todir="${product}/Branching">
			<fileset dir="${web}/Branching"/>
			<fileset file="${build.applets}/CSD.jar"/>
		</copy>
	</target>


	<!-- helper targets - do not call directly -->
	<target name="-clean">
		<delete dir="${build.classes}/${applet}"/>
		<delete file="${build.applets}/${applet}.jar"/>
	</target>

	<target name="-dapplet" depends="init">
		<ant antfile="core.xml" target="dapplet">
			<property name="build.classes" value="${build.classes}/${applet}"/>
		</ant>
	</target>

	<target name="-capplet" depends="init">
		<ant antfile="core.xml" target="capplet">
			<property name="build.classes" value="${build.classes}/${applet}"/>
		</ant>
	</target>

	<target name="-dsims" depends="init">
		<ant antfile="core.xml" target="dsims">
			<property name="build.classes" value="${build.classes}/${simulations}"/>
		</ant>
	</target>

	<target name="-csims" depends="init">
		<ant antfile="core.xml" target="csims">
			<property name="build.classes" value="${build.classes}/${simulations}"/>
		</ant>
	</target>

</project>

