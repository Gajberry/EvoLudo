<!-- ant build file for core classes of VirtualLabs -->

<project name="core" default="all" basedir="." >

	<property name="src" value="src"/>
	<property name="resources" value="resources"/>
	<property name="build" value="build"/>
	<property name="build.classes" value="${build}/classes"/>

	<!-- default compiler args (optimize and maximize compatibility) -->
	<property name="compilerargs" value="-nowarn"/>
	<property name="source" value="1.3"/>
	<property name="target" value="1.2"/>
	<property name="debug" value="off"/>
	<property name="optimize" value="on"/>
	<property name="listfiles" value="no"/>

	<!-- build discrete and continuous applets -->
	<target name="dapplet" depends="dinterface,applet">
		<echo message="Compiling ${applet} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="capplet" depends="cinterface,applet">
		<echo message="Compiling ${applet} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="dsims" depends="dcore,sim">
		<echo message="Compiling ${sim} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="csims" depends="ccore,sim">
		<echo message="Compiling ${sim} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="applet">
		<property name="main" value="${applet}"/>
		<javac srcdir="${src}" 
			   destdir="${build.classes}" 
			   source="${source}" 
			   target="${target}" 
			   listfiles="${listfiles}" 
			   debug="${debug}" 
			   optimize="${optimize}" >
			<include name="chh/virtuallabs/interface/labs/${main}Lab.java"/>
			<include name="chh/virtuallabs/core/labs/${main}.java"/>
			<compilerarg value="${compilerargs}"/>
		</javac>

		<jar destfile="${build.applets}/${applet}.jar" basedir="${build.classes}" >
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Main-Class" value="chh.virtuallabs.${main}Lab"/>
			</manifest>
		</jar>
	</target>

	<target name="sim">
		<property name="game" value="${core}"/>
		<property name="main" value="${sim}"/>
		<javac srcdir="${src}" 
			   destdir="${build.classes}" 
			   source="${source}" 
			   target="${target}" 
			   listfiles="${listfiles}" 
			   debug="${debug}" 
			   optimize="${optimize}" >
			<include name="chh/virtuallabs/core/labs/${game}.java"/>
			<include name="chh/virtuallabs/simulation/${main}.java"/>
			<compilerarg value="${compilerargs}"/>
		</javac>

		<jar destfile="${build.simulations}/${main}.jar" basedir="${build.classes}" >
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Main-Class" value="chh.virtuallabs.${main}"/>
			</manifest>
		</jar>
	</target>

   <!-- build discrete interface -->
  <target name="dinterface" depends="dcore,freehep">
<unjar dest="${build.classes}">
	<fileset dir="lib">
		<include name="freehep-graphics2d-2.1.1.jar"/>
		<include name="freehep-util-2.0.2.jar"/>
		<!-- xml is required for svg -->
		<include name="freehep-xml-2.1.1.jar"/>
		<include name="freehep-io-2.0.2.jar"/>
		<include name="freehep-graphicsio-2.1.1.jar"/>
		<!-- we could add further file formats here -->
		<include name="freehep-graphicsio-pdf-2.1.1.jar"/>
		<include name="freehep-graphicsio-svg-2.1.1.jar"/>
	</fileset>
</unjar>
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/interface/GenericLab.java"/>
        <include name="chh/virtuallabs/interface/PopulationLab.java"/>
        <include name="chh/virtuallabs/interface/DPopulationLab.java"/>
        <include name="chh/virtuallabs/interface/ParamPanel.java"/>
        <include name="chh/virtuallabs/interface/MultiView.java"/>
        <include name="chh/virtuallabs/interface/MVLog.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
        <include name="chh/virtuallabs/interface/MVAbstract.java"/>
        <include name="chh/virtuallabs/interface/MVDMean.java"/>
        <include name="chh/virtuallabs/interface/MVDS3.java"/>
        <include name="chh/virtuallabs/interface/MVDS4Manifold.java"/>
        <include name="chh/virtuallabs/interface/MVDPhase2D.java"/>
        <include name="chh/virtuallabs/interface/MVPop.java"/>
        <include name="chh/virtuallabs/interface/MVFitness.java"/>
        <include name="chh/virtuallabs/interface/MVFitHistogram.java"/>
        <include name="chh/graphics/AbstractGraph.java"/>
        <include name="chh/graphics/LineGraph.java"/>
        <include name="chh/graphics/StateGraphListener.java"/>
        <include name="chh/graphics/StateData.java"/>
		<include name="chh/graphics/S3Graph.java"/>
        <include name="chh/graphics/ParaGraph.java"/>
        <include name="chh/graphics/PopGraph.java"/>
        <include name="chh/graphics/PopData.java"/>
        <include name="chh/graphics/PopFrameLayer.java"/>
        <include name="chh/graphics/PopListener.java"/>
        <include name="chh/graphics/HistoGraphListener.java"/>
        <include name="chh/graphics/FrameLayer.java"/>
        <include name="chh/graphics/S3FrameLayer.java"/>
        <include name="chh/graphics/GlassLayer.java"/>
        <include name="chh/graphics/GraphAxis.java"/>
        <include name="chh/graphics/GraphLabel.java"/>
        <include name="chh/graphics/GraphListener.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
    <copy todir="${build.classes}/${resources}">
        <fileset dir="${resources}" includes="*"/>
    </copy>
  </target>

   <!-- build continuous interface -->
  <target name="cinterface" depends="ccore,freehep">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/interface/GenericLab.java"/>
        <include name="chh/virtuallabs/interface/PopulationLab.java"/>
        <include name="chh/virtuallabs/interface/CXPopulationLab.java"/>
        <include name="chh/virtuallabs/interface/ParamPanel.java"/>
        <include name="chh/virtuallabs/interface/MultiView.java"/>
        <include name="chh/virtuallabs/interface/MVLog.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
        <include name="chh/virtuallabs/interface/MVAbstract.java"/>
        <include name="chh/virtuallabs/interface/MVPop.java"/>
        <include name="chh/virtuallabs/interface/MVCMean.java"/>
        <include name="chh/virtuallabs/interface/MVCTraitHistogram.java"/>
        <include name="chh/virtuallabs/interface/MVCDistr.java"/>
        <include name="chh/virtuallabs/interface/MVC2Distr.java"/>
        <include name="chh/virtuallabs/interface/MVFitness.java"/>
        <include name="chh/virtuallabs/interface/MVFitHistogram.java"/>
        <include name="chh/graphics/AbstractGraph.java"/>
        <include name="chh/graphics/LineGraph.java"/>
        <include name="chh/graphics/StateGraphListener.java"/>
        <include name="chh/graphics/StateData.java"/>
        <include name="chh/graphics/PopGraph.java"/>
        <include name="chh/graphics/PopData.java"/>
        <include name="chh/graphics/PopFrameLayer.java"/>
        <include name="chh/graphics/PopListener.java"/>
        <include name="chh/graphics/HistoGraphListener.java"/>
        <include name="chh/graphics/FrameLayer.java"/>
        <include name="chh/graphics/GlassLayer.java"/>
        <include name="chh/graphics/GraphAxis.java"/>
        <include name="chh/graphics/GraphLabel.java"/>
        <include name="chh/graphics/GraphListener.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
    <copy todir="${build.classes}/${resources}">
        <fileset dir="${resources}" includes="*"/>
    </copy>
  </target>

  <target name="freehep">
	<unjar dest="${build.classes}">
		<fileset dir="lib">
			<include name="freehep-graphics2d-2.1.1.jar"/>
			<include name="freehep-util-2.0.2.jar"/>
			<!-- xml is required for svg -->
			<include name="freehep-xml-2.1.1.jar"/>
			<include name="freehep-io-2.0.2.jar"/>
			<include name="freehep-graphicsio-2.1.1.jar"/>
			<!-- we could add further file formats here -->
			<include name="freehep-graphicsio-pdf-2.1.1.jar"/>
			<include name="freehep-graphicsio-svg-2.1.1.jar"/>
		</fileset>
	</unjar>
  </target>

   <!-- build discrete engine -->
  <target name="dcore" depends="svn,getopt">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/core/util/Analyze.java"/>
        <include name="chh/virtuallabs/core/Population.java"/>
        <include name="chh/virtuallabs/core/DPopulation.java"/>
        <include name="chh/virtuallabs/core/PopulationGeometry.java"/>
        <include name="chh/virtuallabs/core/PopulationParser.java"/>
        <include name="chh/virtuallabs/core/EngineListener.java"/>
        <include name="chh/virtuallabs/core/util/RungeKutta.java"/>
        <include name="chh/virtuallabs/core/util/ReactionDiffusion.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
        <include name="chh/util/ChHMath.java"/>
        <include name="chh/util/ChHFormatter.java"/>
        <include name="chh/util/MersenneTwister.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
  </target>

   <!-- build continuous engine -->
  <target name="ccore" depends="svn,getopt">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/core/util/Analyze.java"/>
        <include name="chh/virtuallabs/core/Population.java"/>
        <include name="chh/virtuallabs/core/CXPopulation.java"/>
        <include name="chh/virtuallabs/core/CPopulation.java"/>
        <include name="chh/virtuallabs/core/PopulationGeometry.java"/>
        <include name="chh/virtuallabs/core/PopulationParser.java"/>
        <include name="chh/virtuallabs/core/EngineListener.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
        <include name="chh/util/ChHMath.java"/>
        <include name="chh/util/ChHFormatter.java"/>
        <include name="chh/util/MersenneTwister.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
  </target>

 <!-- get svn revision -->
  <target name="svn" depends="init">
    <exec executable="svn" output="${build.classes}/svn.info">
        <arg value="info"/>
        <arg value="-r"/>
        <arg value="HEAD"/>
    </exec>
  </target>

  <!-- build getopt -->
  <target name="getopt" depends="init">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="gnu/getopt/Getopt.java"/>
        <include name="gnu/getopt/LongOpt.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>

    <copy todir="${build.classes}">
        <fileset dir="${src}" includes="gnu/getopt/*.properties"/>
    </copy>
  </target>

  <!-- Prepare build directories -->
  <target name="init">
    <mkdir dir="${build}"/>
    <mkdir dir="${build.classes}"/>
  </target>

</project>

