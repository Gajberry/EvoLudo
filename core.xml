<!-- ant build file for core classes of VirtualLabs -->

<project name="core" default="all" basedir="." >

	<property name="src" value="src"/>
	<property name="resources" value="resources"/>
	<property name="build" value="build"/>
	<property name="build.classes" value="${build}/classes"/>

	<!-- default compiler args (optimize and maximize compatibility) -->
	<property name="compilerargs" value="-nowarn"/>
	<property name="source" value="1.3"/>
	<property name="target" value="1.2"/>
	<property name="debug" value="off"/>
	<property name="optimize" value="on"/>
	<property name="listfiles" value="no"/>

	<!-- build discrete and continuous applets -->
	<target name="dapplet" depends="dinterface,applet">
		<echo message="Compiling ${applet} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="capplet" depends="cinterface,applet">
		<echo message="Compiling ${applet} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="dsims" depends="dcore,sim">
		<echo message="Compiling ${sim} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="csims" depends="ccore,sim">
		<echo message="Compiling ${sim} with '${compilerargs}', optimize: ${optimize}, debug: ${debug}"/>
	</target>

	<target name="applet">
		<property name="main" value="${applet}"/>
		<javac srcdir="${src}" 
			   destdir="${build.classes}" 
			   source="${source}" 
			   target="${target}" 
			   listfiles="${listfiles}" 
			   debug="${debug}" 
			   optimize="${optimize}" >
			<include name="chh/virtuallabs/interface/labs/${main}Lab.java"/>
			<include name="chh/virtuallabs/core/labs/${main}.java"/>
			<compilerarg value="${compilerargs}"/>
		</javac>

		<jar destfile="${build.applets}/${applet}.jar" basedir="${build.classes}" >
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Main-Class" value="chh.virtuallabs.${main}Lab"/>
			</manifest>
		</jar>
	</target>

	<target name="sim">
		<property name="game" value="${core}"/>
		<property name="main" value="${sim}"/>
		<javac srcdir="${src}" 
			   destdir="${build.classes}" 
			   source="${source}" 
			   target="${target}" 
			   listfiles="${listfiles}" 
			   debug="${debug}" 
			   optimize="${optimize}" >
			<include name="chh/virtuallabs/core/labs/${game}.java"/>
			<include name="chh/virtuallabs/simulation/${main}.java"/>
			<compilerarg value="${compilerargs}"/>
		</javac>

		<jar destfile="${build.simulations}/${main}.jar" basedir="${build.classes}" >
			<manifest>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Main-Class" value="chh.virtuallabs.${main}"/>
			</manifest>
		</jar>
	</target>

   <!-- build discrete interface -->
  <target name="dinterface" depends="dcore">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/interface/GenericLab.java"/>
        <include name="chh/virtuallabs/interface/PopulationLab.java"/>
        <include name="chh/virtuallabs/interface/DPopulationLab.java"/>
        <include name="chh/virtuallabs/interface/ParamPanel.java"/>
        <include name="chh/virtuallabs/interface/MultiView.java"/>
        <include name="chh/virtuallabs/interface/MVView.java"/>
        <include name="chh/virtuallabs/interface/MVGlass.java"/>
        <include name="chh/virtuallabs/interface/MVFrame.java"/>
        <include name="chh/virtuallabs/interface/MVInfo.java"/>
        <include name="chh/virtuallabs/interface/MVMean.java"/>
        <include name="chh/virtuallabs/interface/MVMeanDStrat.java"/>
        <include name="chh/virtuallabs/interface/MVMeanPayoff.java"/>
        <include name="chh/virtuallabs/interface/MVStructure.java"/>
        <include name="chh/virtuallabs/interface/MVSimplex3.java"/>
        <include name="chh/virtuallabs/interface/MVSimplex4Wk.java"/>
        <include name="chh/virtuallabs/interface/MVPhase2D.java"/>
        <include name="chh/virtuallabs/interface/MVHistogram.java"/>
        <include name="chh/virtuallabs/interface/MVHistogramDPayoff.java"/>
        <include name="chh/virtuallabs/interface/MVHistogramDConnectivity.java"/>
        <include name="chh/virtuallabs/interface/MVLog.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>

        <include name="chh/virtuallabs/interface/MVAbstract.java"/>
        <include name="chh/virtuallabs/interface/MVDMean.java"/>
        <include name="chh/virtuallabs/interface/MVDS3.java"/>
        <include name="chh/graphics/AbstractGraph.java"/>
        <include name="chh/graphics/LineGraph.java"/>
        <include name="chh/graphics/S3Graph.java"/>
        <include name="chh/graphics/CanvasLayer.java"/>
        <include name="chh/graphics/FrameLayer.java"/>
        <include name="chh/graphics/S3FrameLayer.java"/>
        <include name="chh/graphics/GlassLayer.java"/>
        <include name="chh/graphics/GraphAxis.java"/>
        <include name="chh/graphics/GraphListener.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
    <copy todir="${build.classes}/${resources}">
        <fileset dir="${resources}" includes="*"/>
    </copy>
  </target>

   <!-- build continuous interface -->
  <target name="cinterface" depends="ccore">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/interface/GenericLab.java"/>
        <include name="chh/virtuallabs/interface/PopulationLab.java"/>
        <include name="chh/virtuallabs/interface/CXPopulationLab.java"/>
        <include name="chh/virtuallabs/interface/ParamPanel.java"/>
        <include name="chh/virtuallabs/interface/MultiView.java"/>
        <include name="chh/virtuallabs/interface/MVView.java"/>
        <include name="chh/virtuallabs/interface/MVGlass.java"/>
        <include name="chh/virtuallabs/interface/MVFrame.java"/>
        <include name="chh/virtuallabs/interface/MVInfo.java"/>
        <include name="chh/virtuallabs/interface/MVMean.java"/>
        <include name="chh/virtuallabs/interface/MVMeanCStrat.java"/>
        <include name="chh/virtuallabs/interface/MVMeanPayoff.java"/>
        <include name="chh/virtuallabs/interface/MVStructure.java"/>
        <include name="chh/virtuallabs/interface/MVHist2D.java"/>
        <include name="chh/virtuallabs/interface/MVDistrCStrat.java"/>
        <include name="chh/virtuallabs/interface/MVHistogram.java"/>
        <include name="chh/virtuallabs/interface/MVHistogramCStrat.java"/>
        <include name="chh/virtuallabs/interface/MVHistogramCPayoff.java"/>
        <include name="chh/virtuallabs/interface/MVLog.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
    <copy todir="${build.classes}/${resources}">
        <fileset dir="${resources}" includes="*"/>
    </copy>
  </target>

   <!-- build discrete engine -->
  <target name="dcore" depends="svn,getopt">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/core/util/Analyze.java"/>
        <include name="chh/virtuallabs/core/Population.java"/>
        <include name="chh/virtuallabs/core/DPopulation.java"/>
        <include name="chh/virtuallabs/core/PopulationGeometry.java"/>
        <include name="chh/virtuallabs/core/PopulationParser.java"/>
        <include name="chh/virtuallabs/core/EngineListener.java"/>
        <include name="chh/virtuallabs/core/util/RungeKutta.java"/>
        <include name="chh/virtuallabs/core/util/ReactionDiffusion.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
        <include name="chh/util/ChHMath.java"/>
        <include name="chh/util/ChHFormatter.java"/>
        <include name="chh/util/MersenneTwister.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
  </target>

   <!-- build continuous engine -->
  <target name="ccore" depends="svn,getopt">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="chh/virtuallabs/core/util/Analyze.java"/>
        <include name="chh/virtuallabs/core/Population.java"/>
        <include name="chh/virtuallabs/core/CXPopulation.java"/>
        <include name="chh/virtuallabs/core/CPopulation.java"/>
        <include name="chh/virtuallabs/core/PopulationGeometry.java"/>
        <include name="chh/virtuallabs/core/PopulationParser.java"/>
        <include name="chh/virtuallabs/core/EngineListener.java"/>
        <include name="chh/virtuallabs/interface/MVColorModel.java"/>
        <include name="chh/util/ChHMath.java"/>
        <include name="chh/util/ChHFormatter.java"/>
        <include name="chh/util/MersenneTwister.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>
  </target>

 <!-- get svn revision -->
  <target name="svn" depends="init">
    <exec executable="svn" output="${build.classes}/svn.info">
        <arg value="info"/>
        <arg value="-r"/>
        <arg value="HEAD"/>
    </exec>
  </target>

  <!-- build getopt -->
  <target name="getopt" depends="init">
    <javac srcdir="${src}" 
		   destdir="${build.classes}" 
		   source="${source}" 
		   target="${target}" 
		   listfiles="${listfiles}" 
		   debug="${debug}" 
		   optimize="${optimize}" >
        <include name="gnu/getopt/Getopt.java"/>
        <include name="gnu/getopt/LongOpt.java"/>
		<compilerarg value="${compilerargs}"/>
    </javac>

    <copy todir="${build.classes}">
        <fileset dir="${src}" includes="gnu/getopt/*.properties"/>
    </copy>
  </target>

  <!-- Prepare build directories -->
  <target name="init">
    <mkdir dir="${build}"/>
    <mkdir dir="${build.classes}"/>
  </target>

</project>

