# [*EvoLudo*](https://www.evoludo.org) Tests
***Testing consistency of the Evolutionary Dynamics Simulation Toolkit***

Historically, for reasons of efficiency *java* provided minimal freedom in the actual implementations of mathematical functions on different architectures. Primarily this relates to the numerical accuracy in intermediate results. For example, using an extended range for exponents for intermediate calculations could prevent numerical overflows or underflows in the final result, while sticking to *java*'s `double` precision throughout would yield in a different result.

In order to address this issue, the class `java.lang.Math` is accompanied by `java.lang.StrictMath`, which ensures that all intermediate results are also restricted to *java*'s `double` precision and hence become reproducible between platforms.

However, since *java 17* the keyword `strictfp` is deprecated and all floating-point expressions are evaluated strictly such that `strictfp` is no longer needed. By extension `Math` and `StrictMath` now use the same code and produce the same results.

Nevertheless, results generated by *java 21* on Apple silicon and Intel processors show (mostly) small differences in results. The reason for these differences and whether this can be fixed remains unclear. For further information the question ['Is there still a difference between Math and StrictMath after Java 17 and JEP 306?'](https://stackoverflow.com/questions/76674101/is-there-still-a-difference-between-math-and-strictmath-after-java-17-and-jep-30) on stackoverflow may be helpful.

Fortunately, in practice, these differences are easily resolved. In case some *EvoLudo* tests happen to fail on your platform, you simply need to generate a new set of reference tests by running the script `./scripts/generatetests.sh` in the *EvoLudo* root direcrory. This generates a set of reference files in `EvoLudoTest/test/references` in a new directory with the name of the current git version. If all tests are successfully generated the symbolic link `current` is adjusted to point to the new set. Now all test can be run with the script `./scripts/runtests.sh` and pass (until an issue is introduced).

Tests should always pass on the `master` branch but a little more care is taken whenever a tag is assigned.
